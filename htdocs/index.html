<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Photo Booth</title>
    <style>
    	body {	background-color: #000; color: #FFF; 
	        font-family: sans-serif; font-size: 18pt; 
		margin:0; padding:0;
             }
	#imagediv { position:absolute; top:0; bottom:0; left:0; right:0; overflow:hidden; }
	.slides { display:block; position:absolute; min-width:100%; min-height:100%; }
	#info { display:none; position:absolute; left:1em; top:1em; font-size:48pt; font-size:15vh; color:#FFF; text-shadow: black 0.1vw 0.1vw 1vw; }
	#infodrawing { position:absolute; right:0; top:0; height:100%; display:none; }
	#countdown { position:absolute; text-shadow:text-align:center; right:49%; width:2%; top:35%; font-size:20vh; color:#FFF; text-shadow: black 0.1vw 0.1vw 1vw; display:none; }
    </style>

    <script src="jquery/jquery.min.js"></script>
    <script>
	var slides=[];
	var interval=20000; // milli seconds
	var fadetime=1500; // milli seconds
	var loadwait=100; // milli seconds


	var current_slide=-1;
        var current_slide_element=0;
        var this_el;
        var other_el;
	var flip=false;

	function showinfo(msg,autoaway)
	{
	    $("#info").text(msg).fadeIn(250);
	    if (autoaway) setTimeout(function () { $("#info").fadeOut(1000); },parseInt(autoaway)*1000);
	}

	function nextslide()
	{
	    if (slides.length<1) showinfo("No images found!"); // no images !

	    current_slide=(current_slide+1)%slides.length;
	    console.log("nextslide "+current_slide);
	    var tmp=this_el;
	    this_el=other_el;
	    other_el=tmp;

	    this_el.attr("src","images/"+slides[current_slide]);
	    setTimeout(function() {
		    this_el.fadeIn(fadetime);
		    var overflow_y=parseInt(this_el.css("height"))-parseInt($("#imagediv").css("height"));
		    var overflow_x=parseInt(this_el.css("width"))-parseInt($("#imagediv").css("width"));
		    if (overflow_x<0) overflow_x=0;
		    if (overflow_y<0) overflow_y=0;
		    if (overflow_x+overflow_y>0) this_el.animate({left:-overflow_x+"px",top:-overflow_y+"px"},interval-fadetime-100);
		    other_el.fadeOut(fadetime,function () { other_el.css({top:0,left:0}); });
	    },loadwait);
	}

	info_drawing_open=false;

	
	function hide_info_drawing()
	{
	    $("#infodrawing").fadeOut(800,function() { info_drawing_open=false; });
	}

	function show_info_drawing()
	{
	    if (!info_drawing_open)
	    {
		info_drawing_open=true;
		$("#infodrawing").fadeIn(800);
		setTimeout(hide_info_drawing,5000);
	    }
	}

	var webcam_active=false;
	function toggle_webcam()
	{
		//TODO
	}

	function capture_photo() {}

	function capture_countdown()
	{
		$("#countdown").text(5).fadeIn(600).fadeOut(600,function() { $(this).text(4); })
		    .fadeIn(600).fadeOut(600,function() { $(this).text(3); })
		    .fadeIn(600).fadeOut(600,function() { $(this).text(2); })
		    .fadeIn(600).fadeOut(600,function() { $(this).text(1); })
		    .fadeIn(600).fadeOut(600,capture_photo);
	}

	var pollgamepad_interval=false;
	function pollgamepad()
	{
	    var gps;
	    if (! "getGamepads" in navigator)
	    {
		clearInterval(pollgamepad_interval);
		alert("Browser does not support Gamepads");
		return;
	    }
 	    gps=navigator.getGamepads();
	    if (gps.length<0) return; 
	    gp=gps[0];
	    if (!gp || !gp.connected) return; 
	    
	    if (gp.axes[0]!=0 || gp.axes[1]!=0 || gp.buttons[2].pressed || gp.buttons[3].pressed) 
		// user moved stick or pressed other button;
		show_info_drawing();
	    if (gp.buttons[0].pressed) toggle_webcam();
	    if (gp.buttons[1].pressed) { if (webcam_active) capture_countdown(); else show_info_drawing(); }
	}

	$(document).ready(function(){
	    $.getJSON("images.json",function(data){
		slides=data;
		nextslide();
	    });
            this_el=$("#slide0");
            other_el=$("#slide1");
	    flip=setInterval(nextslide,interval);
	    pollgamepad_interval=setInterval(pollgamepad,250);
	});
    </script>
</head>
<body>
   <div id=imagediv>
	<img id=slide0 class=slides>
   	<img id=slide1 class=slides>
   </div>
   <div id=info></div>
   <img id=infodrawing src=info-drawing.svg>
   <div id=countdown></div>
</body>
</html>
